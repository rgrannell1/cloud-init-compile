
"use strict"





const path          = require('path')
const bundleContent = require('./bundle-content')





const compile = (rawArgs, callback) => {

	const args = compile.precond(compile.preprocess(rawArgs))

	bundleContent(args.fpaths, {
		shouldGzip: args.shouldGzip
	}, callback)

}

compile.precond = rawArgs => {

	const detectedBaseNames = new Set( )

	rawArgs.fpaths.forEach(fpath => {

		const fname = path.basename(fpath)

		if (detectedBaseNames.has(fname)) {

			console.error(`error: file-name "${fname}" was repeated in file-path "${fpath}".`)
			process.exit(1)

		} else {
			detectedBaseNames.add(fname)
		}

	})

	return rawArgs

}

compile.preprocess = rawArgs => {

	return {
		shouldGzip: rawArgs['--gzip'],
		fpaths:     rawArgs['<fpath>']
	}

}




module.exports = compile
