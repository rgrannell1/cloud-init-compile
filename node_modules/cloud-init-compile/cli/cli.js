#!/usr/bin/env node

"use strict"




const constants = require('cloud-init-compile/commons/constants')

const encodings = Array.from(constants.supportedEncodings)
	.map(encoding => `--${encoding}`)

const encodingOptions = encodings
	.map(encoding => `	${encoding}`)


const doc = `
Name:
	clic (cloud-init-compile) â€” compile multiple scripts into a single script.

Usage:
	clic (-r FPATH | --run FPATH) [--] <fpath>...
	clic (-r FPATH | --run FPATH) (-z|--gzip) [${encodings.join('|')}] [--] <fpath>...
	clic (-h | --help | --version)

Description:

	clic bundles multiple scripts into a single Bash script that can be executed by
	Cloud-Init. It:

	* Embeds each file into the script as a here-document.
	* Writes each file to its filename on the target machine.
	* Executes a single supplied filename, adding executable permissions if required.

Notes:

	* All files are assumed to be UTF-8 encoded.
	* The highest level of compression is used when gzip is enabled.

Options:
	-r FPATH, --run FPATH    The path or basename of the script to execute. This script must be
	                         included as a path argument too (see below).
	-z, --gzip               Gzip-compress the cloud-init script. This is helpful, as
	                         Cloud-Init scripts are generally limited to 16kb.  If Gzip is enabled, you may use one of the
	                         following encodings:
` +

encodingOptions.join('\n') +

`
	-h, --help               Display this documentation.

Arguments:
	<fpath>...      The relative file paths to load content from.
`





const docopt  = require('docopt').docopt
const compile = require('cloud-init-compile/app/compile')
const args    = docopt(doc)





compile(args, (err, content) => {
	console.log(content)
})
